---
# IRSA Role for Supabase Backup (to write backups to S3)
apiVersion: iam.services.k8s.aws/v1beta1
kind: IAMServiceAccount
metadata:
  name: supabase-backup
  namespace: supabase
spec:
  role:
    name: supabase-backup-role
    policies:
    - name: S3BackupAccess
      document: |
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
              ],
              "Resource": [
                "arn:aws:s3:::stack-ai-supabase-backups",
                "arn:aws:s3:::stack-ai-supabase-backups/*"
              ]
            }
          ]
        }

---
# IRSA Role for Supabase Storage (to access S3 for file uploads)
apiVersion: iam.services.k8s.aws/v1beta1
kind: IAMServiceAccount
metadata:
  name: supabase-storage
  namespace: supabase
spec:
  role:
    name: supabase-storage-role
    policies:
    - name: S3StorageAccess
      document: |
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListBucket",
                "s3:GetObjectAcl",
                "s3:PutObjectAcl"
              ],
              "Resource": [
                "arn:aws:s3:::stack-ai-supabase-storage",
                "arn:aws:s3:::stack-ai-supabase-storage/*"
              ]
            }
          ]
        }
